/*!
 * Torro Forms Version 1.0.0-beta.2 (http://torro-forms.com)
 * Licensed under GNU General Public License v3 (http://www.gnu.org/licenses/gpl-3.0.html)
 */
!function(t,i,e,n){"use strict";function a(t){this.translations=t,this.selectors={participants:"#form-participants",participants_counter:"#form-participants-count",participants_status:"#form-participants-status p",participants_list:"#torro-participants",participant_sub:".participant",invite_button:"#torro-invite-participants-button",reinvite_button:"#torro-reinvite-participants-button",invite_email:"#torro-invite-email",invite_email_input_from_name:"#torro-invite-email input[name=invite_from_name]",invite_email_input_from:"#torro-invite-email input[name=invite_from]",invite_email_input_subject:"#torro-invite-email input[name=invite_subject]",invite_email_input_text:"#invite_text",reinvite_email:"#torro-reinvite-email",reinvite_email_input_from_name:"#torro-reinvite-email input[name=reinvite_from_name]",reinvite_email_input_from:"#torro-reinvite-email input[name=reinvite_from]",reinvite_email_input_subject:"#torro-reinvite-email input[name=reinvite_subject]",reinvite_email_input_text:"#reinvite_text",invite_send:"#torro-send-invitations-button",invite_request_text:"#invites-send-request-text",invite_close:"#invite-close",participants_start:"#participants-start",participants_length:"#participants-length",participants_num_results:"#participants-num-results",participants_slider:"#torro-participants .torro-slider",participants_slider_middle:"#torro-participants .torro-slider-middle",participants_slider_left:"#torro-participants .torro-slider-left",participants_slider_right:"#torro-participants .torro-slider-right",participants_slider_navigation:"#torro-participants .torro-slider-navigation",participants_slider_navigation_prev:"#torro-participants .torro-slider-navigation .torro-nav-prev-link .torro-nav-button",participants_slider_navigation_next:"#torro-participants .torro-slider-navigation .torro-nav-next-link .torro-nav-button",add_participant_option:"#form-add-participants-option",add_participant_button:"#form-add-participants-button",remove_participant_button:".form-delete-participant",remove_all_participants_button:".form-remove-all-participants",remove_participant_text:"#participant-delete-text",remove_all_participants_text:"#participants-delete-all-text",nothing_found:".no-users-found"}}a.prototype={init:function(){this.init_invitations(),this.init_add_members(),this.init_remove_members(),this.init_nav_link(),this.refresh_nothing_found()},init_nav_link:function(){var t=this;e(t.selectors.participants_slider_navigation_next).on("click",t.participants,function(n){n.preventDefault();var a=e(this);a.addClass("button-loading");var s=e(this).attr("href");i.ajax.post("torro_get_participants_list",{nonce:t.translations.nonce_get_participants_list,form_id:t.get_form_id(),start:t.get_url_param_value(s,"torro-start"),length:t.get_url_param_value(s,"torro-length"),num_results:t.get_url_param_value(s,"torro-num-results")}).done(function(i){e(t.selectors.participants_slider_middle+", "+t.selectors.participants_slider_navigation).fadeOut(500,function(){e(t.selectors.participants_slider_middle).html(i.table),e(t.selectors.participants_slider_middle).fadeIn(500),e(t.selectors.participants_slider_navigation).html(i.navi),e(t.selectors.participants_slider_navigation).fadeIn(500),t.init_nav_link()}),a.removeClass("button-loading")}).fail(function(t){a.removeClass("button-loading"),console.log(t)})}),e(t.selectors.participants_slider_navigation_prev).on("click",t.participants,function(n){n.preventDefault();var a=e(this);a.addClass("button-loading");var s=e(this).attr("href");i.ajax.post("torro_get_participants_list",{nonce:t.translations.nonce_get_participants_list,form_id:t.get_form_id(),start:t.get_url_param_value(s,"torro-start"),length:t.get_url_param_value(s,"torro-length"),num_results:t.get_url_param_value(s,"torro-num-results")}).done(function(i){e(t.selectors.participants_slider_middle+", "+t.selectors.participants_slider_navigation).fadeOut(500,function(){e(t.selectors.participants_slider_middle).html(i.table),e(t.selectors.participants_slider_middle).fadeIn(500),e(t.selectors.participants_slider_navigation).html(i.navi),e(t.selectors.participants_slider_navigation).fadeIn(500),t.init_nav_link()}),a.removeClass("button-loading")}).fail(function(t){a.removeClass("button-loading"),console.log(t)})})},init_add_members:function(){var t=this;e(document).on("click",this.selectors.add_participant_button,function(){var n=e(this);n.addClass("button-loading");var a=e(t.selectors.add_participant_option).val();"allmembers"==a&&i.ajax.post("torro_add_participants_allmembers",{nonce:t.translations.nonce_add_participants_allmembers,form_id:t.get_form_id()}).done(function(i){e(t.selectors.participants_list).html(i.html),console.log(i.html),t.init_nav_link(),n.removeClass("button-loading")}).fail(function(t){console.log(t)})})},init_remove_members:function(){var t=this;e(document).on("click",t.selectors.remove_all_participants_button,function(){var n=e(t.selectors.remove_all_participants_text);n.dialog({dialogClass:"wp-dialog",modal:!0,autoOpen:!1,closeOnEscape:!0,minHeight:80,buttons:[{text:t.translations.yes,click:function(){i.ajax.post("torro_delete_all_participants",{nonce:t.translations.nonce_delete_all_participants,form_id:t.get_form_id()}).done(function(i){e(t.selectors.participants_slider_middle).html(i.table),e(t.selectors.participants_slider_navigation).html(i.navi)}).fail(function(t){console.log(t)}),e(this).dialog("close")}},{text:t.translations.no,click:function(){e(this).dialog("close")}}]}),n.dialog("open")}),e(document).on("click",t.selectors.remove_participant_button,function(){var n=e(this).attr("data-user-id"),a=e(t.selectors.participants_start).val(),s=e(t.selectors.participants_length).val(),r=e(t.selectors.participants_num_results).val(),o=e(this);o.addClass("button-loading"),i.ajax.post("torro_delete_participant",{nonce:t.translations.nonce_delete_participant,form_id:t.get_form_id(),user_id:n,start:a,length:s,num_results:r}).done(function(i){e(t.selectors.participants_num_results).val(r-1),e(t.selectors.participants_slider_middle).html(i.table),e(t.selectors.participants_slider_navigation).html(i.navi),o.removeClass("button-loading")}).fail(function(t){console.log(t),o.removeClass("button-loading")})})},init_invitations:function(){var t=this,n="none";e(t.selectors.invite_button).on("click",function(){"none"==n||"reinvite"==n?(n="invite",e(t.selectors.reinvite_button).removeClass("active"),e(t.selectors.invite_button).addClass("active"),i.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(i){if(""==e(t.selectors.invite_email_input_from_name).val()&&""==e(t.selectors.invite_email_input_from).val()&&""==e(t.selectors.invite_email_input_subject).val()&&""==e(t.selectors.invite_email_input_text).val()){e(t.selectors.invite_email_input_from_name).val(i.invite_from_name),e(t.selectors.invite_email_input_from).val(i.invite_from),e(t.selectors.invite_email_input_subject).val(i.invite_subject);var n=tinymce.get("invite_text");n&&n instanceof tinymce.Editor&&n.setContent(i.invite_text.replace(/\r?\n/g,"<br />"))}}).fail(function(t){console.error(t)}),e(t.selectors.reinvite_email).hide(),e(t.selectors.invite_email).show(),e(t.selectors.invite_send).show(),e(t.selectors.invite_close).show()):(n="none",e(t.selectors.invite_button).removeClass("active"),e(t.selectors.invite_email).hide(),e(t.selectors.invite_send).hide(),e(t.selectors.invite_close).hide())}),e(t.selectors.reinvite_button).on("click",function(){"none"==n||"invite"==n?(n="reinvite",e(t.selectors.invite_button).removeClass("active"),e(t.selectors.reinvite_button).addClass("active"),i.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(i){if(""==e(t.selectors.reinvite_email_input_from_name).val()&&""==e(t.selectors.reinvite_email_input_from).val()&&""==e(t.selectors.reinvite_email_input_subject).val()&&""==e(t.selectors.reinvite_email_input_text).val()){e(t.selectors.reinvite_email_input_from_name).val(i.invite_from_name),e(t.selectors.reinvite_email_input_from).val(i.invite_from),e(t.selectors.reinvite_email_input_subject).val(i.invite_subject);var n=tinymce.get("reinvite_text");n&&n instanceof tinymce.Editor&&n.setContent(i.invite_text.replace(/\r?\n/g,"<br />"))}}).fail(function(t){console.error(t)}),e(t.selectors.invite_email).hide(),e(t.selectors.reinvite_email).show(),e(t.selectors.invite_send).show(),e(t.selectors.invite_close).show()):(n="none",e(t.selectors.reinvite_button).removeClass("active"),e(t.selectors.reinvite_email).hide(),e(t.selectors.invite_send).hide(),e(t.selectors.invite_close).hide())}),e(t.selectors.invite_close).on("click",function(){e(t.selectors.invite_button).removeClass("active"),e(t.selectors.reinvite_button).removeClass("active"),e(t.selectors.invite_email).hide(),e(t.selectors.reinvite_email).hide(),e(t.selectors.invite_send).hide(),e(t.selectors.invite_close).hide()}),e(t.selectors.invite_send).on("click",function(){var n=e(this),a=e(t.selectors.invite_request_text);a.dialog({dialogClass:"wp-dialog",modal:!0,autoOpen:!1,closeOnEscape:!0,minHeight:80,buttons:[{text:t.translations.yes,click:function(){e(this).dialog("close"),n.addClass("button-loading");var a="invite";if(e(t.selectors.invite_button).hasClass("active"))var s=e(t.selectors.invite_email_input_from_name).val(),r=e(t.selectors.invite_email_input_from).val(),o=e(t.selectors.invite_email_input_subject).val(),l=e(t.selectors.invite_email_input_text).val();else{a="reinvite";var s=e(t.selectors.reinvite_email_input_from_name).val(),r=e(t.selectors.reinvite_email_input_from).val(),o=e(t.selectors.reinvite_email_input_subject).val(),l=e(t.selectors.reinvite_email_input_text).val()}i.ajax.post("torro_invite_participants",{nonce:t.translations.nonce_invite_participants,form_id:t.get_form_id(),from_name:s,from:r,subject:o,text:l,invitation_type:a}).done(function(i){e("#form-functions-notices").html(t.translations.deleted_results_successfully),e("#form-functions-notices").show(),n.removeClass("button-loading"),e("#form-functions-notices").fadeOut(5e3)}).fail(function(t){console.error(t),n.removeClass("button-loading")})}},{text:t.translations.no,click:function(){e(this).dialog("close")}}]}),a.dialog("open")})},set_participants_counter:function(t){var i=t+" "+this.translations.added_participants;e(this.selectors.participants_status).html(i),e(this.selectors.participants_counter).val(t)},refresh_nothing_found:function(){0<parseInt(e(this.participants_counter).val())?e(this.selectors.nothing_found).hide():e(this.selectors.nothing_found).show()},get_url_param_value:function(t,i){var e=t.split("?");e=e[1],e=e.split("&");for(var n=0;n<e.length;n++){var a=e[n].split("=");if(a[0]==i)return a[1]}},get_form_id:function(){return e("#post_ID").val()}},t.add_extension("access_control_selected_members",new a(n))}(form_builder,wp,jQuery,translation_sm);